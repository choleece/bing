<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="cn.choleece.bing.ums.mapper.SysMenuMapper">

    <resultMap id="sysMenu" type="cn.choleece.bing.ums.entity.SysMenu">
        <id property="menuId" column="menu_id"/>
        <result property="parentId" column="parent_id"/>
        <result property="name" column="name"/>
        <result property="url" column="url"/>
        <result property="perms" column="perms"/>
        <result property="type" column="type"/>
        <result property="icon" column="icon"/>
        <result property="orderNum" column="order_num"/>
        <result property="status" column="status"/>
    </resultMap>

    <select id="listUserMenu" resultMap="sysMenu">
        select sm.menu_id, sm.parent_id, sm.name, ifnull(sm.url, "") as url, ifnull(sm.icon, "") as icon
        from sys_menu sm
        inner join (
            select srm.menu_id as menu_id
            from sys_role_menu srm
            inner join sys_user_role sur on srm.role_id = sur.role_id
            where sur.user_id = #{uid}
        ) t on t.menu_id = sm.menu_id
        where sm.status = 1 and find_in_set(sm.type, '0,1')
        order by sm.menu_id ASC, sm.order_num ASC
    </select>

</mapper>